{"version":3,"sources":["dcs/pasi/app/view/unauthenticated/chart.cljs"],"mappings":";AASA,yEAAA,2CAAA,0DAAA,6CAAA,uDAAA,MAAA,sDAAA,6BAAA,qDAAA,2CAAA,wDAAA,4EAAA,+DAAA,mFAAA,2CAAA,8DAAA,cAAA,wDAAA,KAAA,iDAAA,kBAAA,2CAAA,+DAAA,mFAAA,2CAAA,kDAAA,MAAA,wDAAA,qBAAA,iDAAA,qCAAA,2DAAA,mFAAA,UAAA,8BAAA,2CAAA,gEAAA,kCAAA,iDAAA,yCAAA,wDAAA,mFAAA,2CAAA,qDAAA,2CAAA,qDAAA,MAAA,oFAAA,IAAA,sFAAA,YAAA,6DAAA,2CAAA,+CAAA,2CAAA,sDAAA,eAAA,wDAAA,UAAA,qDAAA,WAAA,sDAAA,2CAAA,8DAAA,4GAAA,gEAAA,aAAA,8DAAA,cAAA,uDAAA,2CAAA,yDAAA,mFAAA,sBAAA,2CAAA,oDAAA,wCAAA,gDAAA,2CAAA,sDAAA,+BAAA,wDAAA,yBAAA,qDAAA,uBAAA,uDAAA,2CAAA,sDAAA,eAAA,wDAAA,cAAA,qDAAA,UAAA,uDAAA,2CAAA,uDAAA,oBAAA,0DAAA,2CAAA,2DAAA,oBAAA,4DAAA,mFAAA,2CAAA,sDAAA,eAAA,wDAAA,UAAA,qDAAA,WAAA,0DAAA,iBAAA,2CAAA,sDAAA,+BAAA,wDAAA,yBAAA,qDAAA,eAAA,0DAAA,cAAA,2CAAA,sDAAA,eAAA,wDAAA,cAAA,qDAAA,kDAAA,wDAAA,2CAAA,uDAAA,2CAAA,oDAAA,pxLAAKA;AAoDL,AAAKC,6FACCD,nBACA,0FAAA,mFAAA,wDAAA,IAAA,qDAAA,6DAAA,3VAACE;AAEP,AAAKC,4LACCH,nBACA,0FAAA,mFAAA,+DAAA,IAAA,2DAAA,YAAA,vTAACE,nBACD,qVAAA,mFAAA,wDAAA,IAAA,6DAAA,uDAAA,8DAAA,tpBAACA,nBACD,yrBAAA,mFAAA,wDAAA,IAAA,6DAAA,uDAAA,gEAAA,5/BAACA,nBACD,0hCAAA,mFAAA,wDAAA,IAAA,6DAAA,uDAAA,0DAAA,mEAAA,15CAACA,nBACD,k7CAAA,mFAAA,wDAAA,IAAA,6DAAA,4DAAA,IAAA,8DAAA,5vDAACA,nBACD,+xDAAA,mFAAA,wDAAA,IAAA,6DAAA,4DAAA,IAAA,gEAAA,3mEAACA;AAEP,AAAKE,8FACCD,nBACA,2FAAA,mFAAA,wDAAA,IAAA,qDAAA,6DAAA,5VAACD;AAEP,0DAAA,gDAAA,mFAAA,eAAA,2FAAA,mFAAA,eAAA,6FAAA,mFAAA,eAAA,4FAAA,mFAAA,eAAA,twBAAKG,gOAC2BL,8LACCC,8LACDE,+LACCC;AAGjC,8CAAA,9CAAME,oGAAKC,MAAMC,eAAeC,cAAcC,iBAAiBC,iBAAiBC;AAAhF,AACE,IAAMC,iBAAe,iBAAAC,WAAA,mFAAkBH,iBAAiBC;AAAnC,AAAA,sLAAAE,8EAAAA,5PAACT,wFAAAA,kGAAAA;;IAChBU,aAAW,kCAAA,mFAAA,qDAAA,1KAACb,mBAASW,uNAA+B,AAACG,gDAAcT,MAAMC,eAAeC,cAAcC;AAD5G,AAAA,0FAEGO,kBAAaF,WAAWG;;AAG7B,+CAAA,/CAAME;AAAN,AAAA,sIAAA,AAAAD,yDAAA,AAAAA,kEAAA,AAAAA,iEAAA,AAAAA,oEAAA,AAAAA,oEAAA,AAAAA,hXACGb,4DACCe,yDACAC,kEACAC,iEACAC,oEACAC,oEACAC","names":["dcs.pasi.app.view.unauthenticated.chart/chart-template-wasteStream-bar","dcs.pasi.app.view.unauthenticated.chart/chart-template-wasteStream-line","cljs.core/assoc-in","dcs.pasi.app.view.unauthenticated.chart/chart-template-organisation-bar","dcs.pasi.app.view.unauthenticated.chart/chart-template-organisation-line","dcs.pasi.app.view.unauthenticated.chart/chart-templates","dcs.pasi.app.view.unauthenticated.chart/ele","wr-ds","selected-years","selected-orgs","selected-streams","selected-groupby","selected-charttype","chart-template","G__60917","chart-spec","dcs.pasi.app.view.unauthenticated.tmp/filter-ds","oz.core/vega-lite","dcs.pasi.app.util/vega-embed-opts","cljs.core/deref","dcs.pasi.app.view.unauthenticated.chart/root","dcs.pasi.app.state/unauthn-wr-ds-cursor","dcs.pasi.app.state/unauthn-selected-years-cursor","dcs.pasi.app.state/unauthn-selected-orgs-cursor","dcs.pasi.app.state/unauthn-selected-streams-cursor","dcs.pasi.app.state/unauthn-selected-groupby-cursor","dcs.pasi.app.state/unauthn-selected-charttype-cursor"],"sourcesContent":["(ns dcs.pasi.app.view.unauthenticated.chart\n  (:require [cljs.spec.alpha :as s]\n            [clojure.string :as str]\n            [reagent.core :as r]\n            [oz.core :as oz]\n            [dcs.pasi.app.util :as util]\n            [dcs.pasi.app.state :as state]\n            [dcs.pasi.app.view.unauthenticated.tmp :as tmp]))\n\n(def chart-template-wasteStream-bar\n  {:schema    \"https://vega.github.io/schema/vega/v5.json\"\n   :width      700 ;\"container\"\n   ;:height     500\n   ;:background \"#f2dfce\"\n   :title     \"Carbon savings per quarter\"\n   :data      {:values :PLACEHOLDER}\n   :transform [{:timeUnit \"yearquarter\"\n                :field    \"to\"\n                :as       \"quarter\"}\n               {:aggregate [{:op    \"sum\" ;; TODO calc this properly\n                             :field \"carbonSavingCo2eKg\"\n                             :as    \"carbonSavingCo2eKg\"}]\n                :groupby   [\"quarter\" \"wasteStream\"]}\n               {:calculate \"datum.carbonSavingCo2eKg / 1000\" :as \"carbonSavingCo2eTonnes\"}]\n   :layer     [{:mark     {:type                 \"bar\"\n                           :cornerRadiusTopLeft  3\n                           :cornerRadiusTopRight 3}\n                :encoding {:x       {:title \"Year quarter\"\n                                     :field \"quarter\"\n                                     :type  \"temporal\"\n                                     :axis  {:labelExpr  \"timeFormat(datum.value, '%q') == '1' ? timeFormat(datum.value, 'Q%q %Y') : timeFormat(datum.value, 'Q%q')\"\n                                             :labelAngle 45\n                                             #_:tickCount  #_{:interval \"month\"\n                                                          :step     3\n                                                          :start    0}\n                                             ;:tickBand \"extent\"\n                                             }\n                                     :timeUnit \"yearquarter\"\n                                     :scale {:domain [\"2013-01-01T00:00:00\" {:expr \"now()\"}]}}\n                           :y       {:title \"Carbon savings (CO2e tonnes)\"\n                                     :field \"carbonSavingCo2eTonnes\"\n                                     :type  \"quantitative\"}\n                           :color   {:title \"Waste stream\"\n                                     :field \"wasteStream\" \n                                     :type \"nominal\" \n                                     :scale {:scheme \"tableau20\"} \n                                     :legend {:columns 2}}\n                           :tooltip [{:title  \"Year quarter\"\n                                      :field  \"quarter\"\n                                      :type   \"temporal\"\n                                      :format \"Q%q %Y\"}\n                                     {:title  \"Carbon Savings (CO2e tonnes)\"\n                                      :field  \"carbonSavingCo2eTonnes\"\n                                      :type   \"quantitative\"\n                                      :format \".3f\"}\n                                     {:title \"Waste stream\"\n                                      :field \"wasteStream\"\n                                      :type \"nominal\"}]}}]\n   :config    {:axisX {:grid false}}})\n\n\n(def chart-template-wasteStream-line\n  (-> chart-template-wasteStream-bar\n      (assoc-in [:layer 0 :mark :type] \"line\")))\n\n(def chart-template-organisation-bar \n  (-> chart-template-wasteStream-bar\n      (assoc-in [:transform 1 :groupby 1] \"enabler\")\n      (assoc-in [:layer 0 :encoding :color :title] \"Organisation\")\n      (assoc-in [:layer 0 :encoding :color :field] \"enabler\")\n      (assoc-in [:layer 0 :encoding :color :legend :columns] 1)\n      (assoc-in [:layer 0 :encoding :tooltip 2 :title] \"Organisation\")\n      (assoc-in [:layer 0 :encoding :tooltip 2 :field] \"enabler\")))\n\n(def chart-template-organisation-line\n  (-> chart-template-organisation-bar\n      (assoc-in [:layer 0 :mark :type] \"line\")))\n\n(def chart-templates \n  {[\"Waste stream\" \"Bar chart\"] chart-template-wasteStream-bar\n   [\"Waste stream\" \"Line chart\"] chart-template-wasteStream-line\n   [\"Organisation\" \"Bar chart\"] chart-template-organisation-bar\n   [\"Organisation\" \"Line chart\"] chart-template-organisation-line})\n  \n\n(defn ele [wr-ds selected-years selected-orgs selected-streams selected-groupby selected-charttype]\n  (let [chart-template (chart-templates [selected-groupby selected-charttype])\n        chart-spec (assoc-in chart-template [:data :values] (tmp/filter-ds wr-ds selected-years selected-orgs selected-streams))]\n    [oz/vega-lite chart-spec util/vega-embed-opts]))\n\n\n(defn root []\n  [ele\n   @state/unauthn-wr-ds-cursor\n   @state/unauthn-selected-years-cursor\n   @state/unauthn-selected-orgs-cursor\n   @state/unauthn-selected-streams-cursor\n   @state/unauthn-selected-groupby-cursor\n   @state/unauthn-selected-charttype-cursor])"]}